# Crowd Person Detection (YOLOv8)

## Описание
Данный проект представляет собой программу на Python для детекции людей на видеофайле с использованием предобученной модели **YOLOv8**.  
Программа покадрово обрабатывает видео, находит людей (класс `person`), отрисовывает bounding box с указанием класса и уверенности распознавания и сохраняет результат в видеофайл.

Решение ориентировано на воспроизводимость и кроссплатформенность (Linux / macOS / Windows).

---

## Используемый подход
- Модель: **YOLOv8 (pretrained, COCO dataset)**
- Тип задачи: object detection
- Детектируемый класс: `person`
- Обработка: покадровая
- Отрисовка: bounding box + имя класса + confidence
- Запись видео: через `ffmpeg` (H.264 + `yuv420p`) для максимальной совместимости

---

## Структура проекта
- main.py # основной исполняемый файл
- src/crowd.mp4 # входное видео (НЕ хранится в репозитории)
- output/result.mp4 # результат работы программы
- requirements.txt  # требования
- README.md 
- .gitignore

⚠️ Папки `src/` и `output/` создаются/используются локально и не хранятся в git.


## Установка

### 1. Создание виртуального окружения
```bash
python -m venv .venv
```
Linux / macOS:
```bash
source .venv/bin/activate
```
Windows (PowerShell):
```bash
.\.venv\Scripts\Activate.ps1
```
2. Установка зависимостей
```bash
pip install -r requirements.txt
```


## Запуск программы
1. Поместите входное видео по пути:
```bash
src/crowd.mp4
```
2. Запустите программу из корня проекта:
```bash
python main.py
```
3. Результат будет сохранён в:
```bash
output/processed_output.mp4
```

## Зависимости и совместимость окружения

### NumPy (важное примечание для macOS)

На некоторых системах (в частности, **macOS**) при установке зависимостей может автоматически устанавливаться **NumPy версии 2.x**, что приводит к ошибке:

**`RuntimeError: Numpy is not available`**


Это связано с несовместимостью текущих сборок **PyTorch / Ultralytics** с NumPy 2.x.

Для корректной работы проекта используется **NumPy версии < 2.0**.

Если ошибка возникает, выполните в активированном виртуальном окружении:

```bash
pip install "numpy<2"
```

## Примечание о запуске Python на разных ОС

В зависимости от операционной системы команда запуска Python может называться по-разному:
- **Linux / Ubuntu**
По умолчанию используется команда **`python3`**:
```bash
python3 -m venv .venv
source .venv/bin/activate
python3 -m pip install -r requirements.txt
python3 main.py
```
- **macOS**
В большинстве случаев доступна команда **`python`**, но также может потребоваться **`python3`**
```bash
python3 -m venv .venv
source .venv/bin/activate
python3 -m pip install -r requirements.txt
python3 main.py
```
- **Windows**
В PowerShell:
```bash
python -m venv .venv
.\.venv\Scripts\Activate.ps1
pip install -r requirements.txt
python main.py
```
Если активация виртуального окружения заблокирована политикой PowerShell, выполните:
```bash
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process
```

## Кроссплатформенность

Для корректного воспроизведения выходного видео на **Linux, macOS и Windows** используется кодирование:
- видеокодек **H.264** (`libx264`)
- пиксельный формат **`yuv420p`**
- флаг **`faststart`** для корректной работы медиаплееров

Кодирование выполняется через `ffmpeg`, поставляемый вместе с Python-пакетом `imageio-ffmpeg`, поэтому **не требуется отдельная установка ffmpeg в системе**.

---

## Анализ качества распознавания

### Сильные стороны
- Уверенная детекция людей, находящихся близко к камере.
- Стабильные bounding box без выраженного мерцания.

### Типичные ошибки
- **False Negatives (FN)**:
  - люди на дальнем плане;
  - сильные перекрытия (occlusion).
- **False Positives (FP)**:
  - редкие ложные срабатывания на контрастных участках фона;
  - картины с изображением людей.

### Влияние параметров
- `conf` — увеличение уменьшает количество ложных срабатываний (FP), но увеличивает пропуски (FN).
- `iou` — регулирует агрессивность Non-Maximum Suppression; слишком высокий порог может оставлять дублирующиеся bounding box.
- `imgsz` — увеличение помогает при детекции мелких объектов, но существенно снижает скорость обработки.

---

## Возможные улучшения качества

 Дообучение (fine-tuning) модели на размеченных кадрах из данного видео.

---

## Примечания

- Входное видео намеренно не включено в репозиторий.
- Папка `output/` не хранится в git и создаётся автоматически при запуске программы.
